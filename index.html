<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Topo HÃ¶jdsÃ¶kare</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="crosshair"></div>

	<div id="info-modal" class="modal-overlay">
			<div class="modal-content">
				<h4 id="info-title">Om Topo HÃ¶jdsÃ¶kare</h4>
				<p id="info-desc">Detta verktyg hjÃ¤lper dig att analysera terrÃ¤ng fÃ¶r att hitta de hÃ¶gsta punkterna samt berÃ¤kna maximal stigning inom ett givet omrÃ¥de.</p>
				
				<p><strong><span id="info-creator">Skapare</span>:</strong> <a href="http://droidgren.github.io/" target="_blank">droidgren.github.io</a></p>
				
				<p style="font-size: 12px; color: #666; margin-top: 5px; margin-bottom: 0;">
					<span id="lbl-version">Version</span>: <span id="app-version">--</span>
				</p>

				<p id="info-privacy" style="font-size: 12px; color: #888; border-top: 1px solid #eee; padding-top: 10px; margin-top: 15px;">
					Denna applikation Ã¤r helt klientbaserad. Det innebÃ¤r att den kÃ¶rs direkt i din webblÃ¤sare och ingen data eller sÃ¶kningar sparas pÃ¥ nÃ¥gon server.
				</p>
				<button id="info-close" class="save-btn" onclick="closeInfo()">StÃ¤ng</button>
			</div>
		</div>

    <div id="key-modal" class="modal-overlay">
        <div class="modal-content">
            <h4 id="modal-title">Ange API-nyckel</h4>
            <p id="modal-text">...</p>
            <p><a id="modal-link" href="#" target="_blank">Registrera dig hÃ¤r</a></p>
            <input type="text" id="api-key-input" placeholder="...">
            <div class="modal-btns">
                <button id="modal-save" class="save-btn" onclick="saveApiKey()">Spara</button>
                <button id="modal-cancel" class="cancel-btn" onclick="cancelApiKey()">Avbryt</button>
            </div>
        </div>
    </div>

    <div id="controls">
        <div class="header-row">
            <h3 id="app-title">Topo HÃ¶jdsÃ¶kare</h3>
            <div class="header-buttons">
                <button class="circle-btn" onclick="toggleLanguage()" title="Byt sprÃ¥k / Switch Language">
                    <img id="flag-icon" class="flag-img" src="" alt="Flag">
                </button>
                <button class="circle-btn info-btn" onclick="showInfo()" title="Om / About">i</button>
                <button class="toggle-btn" onclick="toggleControls()" title="Minimera/Expandera">â–</button>
            </div>
        </div>

        <div class="live-height-box">
            <span id="liveLabel" class="live-label">HÃ–JD Ã–VER HAVET</span>
            <span id="center-h" class="live-value">-- m</span>
        </div>

        <div id="controls-content">
            
            <div style="margin-bottom: 10px;">
                <span id="lbl-layers" class="control-label" style="display:block; margin-bottom:3px;">Kartlager:</span>
                <div class="select-container">
                    <select id="layerSelect" onchange="handleLayerChange(this.value)">
                        <option value="opentopo" selected>OpenTopo</option>
                        <option value="osm">OpenStreetMap</option>
                        <option value="tracetrack">Tracetrack Topo</option>
                        <option value="thunderforest">ThunderForest Outdoors</option>
                        <option value="satellite">Satellit (ESRI)</option>
                        <option value="debug">HÃ¶jddata (Debug)</option>
                    </select>
                    <button id="edit-key-btn" class="icon-btn" onclick="openCurrentKeyModal()" title="API">ğŸ”‘</button>
                </div>
            </div>

            <div class="search-group">
                <input type="text" id="searchInput" placeholder="SÃ¶k plats">
                <button class="icon-btn" onclick="locateUser()" title="GPS">ğŸ“</button>
                <button class="icon-btn" onclick="searchLocation()" title="SÃ¶k">ğŸ”</button>
            </div>
            
            <hr style="border:0; border-top:1px solid #eee; width:100%; margin: 5px 0;">
            
            <div class="control-row">
                <span id="lbl-radius" class="control-label">SÃ¶kradie (km):</span>
                <input type="number" id="radiusInput" value="1" min="0.5" max="100" step="0.5">
            </div>

            <div class="control-row">
                <span id="lbl-points" class="control-label">Antal punkter:</span>
                <input type="number" id="numPoints" value="3" min="1" max="50">
            </div>
            
            <div class="checkbox-group">
                <div class="checkbox-row">
                    <input type="checkbox" id="show-circle" checked>
                    <label id="lbl-show-circle" for="show-circle">Visa radie</label>
                </div>
                
                <div class="checkbox-row">
                    <input type="checkbox" id="lock-circle">
                    <label id="lbl-lock-circle" for="lock-circle" title="LÃ¥s">ğŸ”’ LÃ¥s radie</label>
                </div>
            </div>

            <button id="scan-btn" class="action-btn" onclick="analyzeTerrain()" disabled>ğŸ“ Hitta hÃ¶gsta punkter</button>

            <hr style="border:0; border-top:1px solid #eee; width:100%; margin: 10px 0;">
            
            <div class="control-row">
                <span id="lbl-climb-dist" class="control-label">MÃ¤tstrÃ¤cka (m):</span>
                <input type="number" id="climbDistInput" value="200" min="50" max="5000" step="10">
            </div>

            <div class="control-row">
                <span id="lbl-num-climbs" class="control-label">Antal stigningar:</span>
                <input type="number" id="numClimbsInput" value="1" min="1" max="10">
            </div>

            <button id="climb-btn" class="climb-btn" onclick="findSteepestClimb()" disabled>ğŸ“ˆ Hitta stigningar</button>

            <button id="clear-btn" class="clear-btn" onclick="clearResults()">ğŸ—‘ï¸ Rensa resultat</button>
            
            <div class="footer-row">
                <div id="status">Redo.</div>
                <span id="zoom-level" class="zoom-badge">Zoom: 11</span>
            </div>
        </div>
    </div>

    <canvas id="analysis-canvas"></canvas>
    <canvas id="single-point-canvas" width="1" height="1"></canvas>
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>